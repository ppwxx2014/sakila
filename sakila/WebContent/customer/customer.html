<!doctype html>
<html lang="kor">
<head>
<title>Sidebar 02</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/sakila/assets/css/style.css">
<link rel="stylesheet" href="/sakila/assets/css/templateStyle.css">
</head>
<body>
	<div class="wrapper d-flex align-items-stretch">
		<nav id="sidebar"></nav>

		<!-- Page Content  -->
		<div id="content" class="p-4 p-md-5 pt-5">
			<!-- header -->
			<nav class="navbar navbar-expand-sm header">
				<ul class="navbar-nav">
					<li><strong>Customer │ 고객 관리</strong></li>
				</ul>
			</nav>
			<hr class="division">
			<!-- /header -->

			<div>
				<!-- 주소를 먼저 입력 -->
				<table border="1">
					<tr>
						<td>
							<!-- 1. country list select -->
							<div>
								<select size="10" id="countryList">

								</select>
							</div>
						</td>

						<td>
							<!-- 2. city list select -->
							<div>
								<select size="10" id="cityList">

								</select>
							</div>
						</td>
					</tr>
				</table>
				<!-- 고객의 정보가 입력 -->
				<h3>고객 정보를 입력</h3>
				<form>
					<fieldset>
						<legend>주소정보</legend>
						<div>
							cityId : <input type="text" id="cityId" readonly="readonly">
						</div>
						<!-- 자동입력 -->
						<div>
							address : <input type="text" id="address">
						</div>
						<div>
							address2 : <input type="text" id="address2">
						</div>
						<div>
							district : <input type="text" id="district">
						</div>
						<div>
							postalCode : <input type="text" id="postalCode">
						</div>
						<div>
							phone : <input type="text" id="phone">
						</div>
					</fieldset>
					<fieldset>
						<legend>고객정보</legend>
						<div>
							storeId : <select id="storeId">
								<option value="1">1</option>
								<option value="2">2</option>
							</select>
						</div>
						<div>
							firstName : <input type="text" id=firstName>
						</div>
						<div>
							lastName : <input type="text" id=lastName>
						</div>
						<div>
							e-mail : <input type="text" id=email>
						</div>
					</fieldset>
					<button type="button" id="addCustomer">고객 입력</button>
				</form>
			</div>
			<h2>customer list</h2>
			<!-- 고객의 정보(일부) 리스트 : 클릭시 상세정보 링크 -->
			<table border="1">
				<thead>
					<tr>
						<th>customerId</th>
						<th>firstName</th>
						<th>lastName</th>
						<th>email</th>
					</tr>
				</thead>
				<tbody id="list">

				</tbody>
			</table>
		</div>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="/sakila/assets/js/popper.js"></script>
	<script src="/sakila/assets/js/bootstrap.min.js"></script>
	<script src="/sakila/assets/js/main.js"></script>
	
	<script>
		$("#sidebar").load("/sakila/templates/aside.html");
	</script>
	
	<script>
	// 리스트
	$.ajax({
		url : "/sakila/customer/selectCustomer",
		method : "post",
		success : function(json) {
			console.log("Customer List Success!");
			$(json).each(function(index, item) {
				let html = "<tr>";
				html += "<td>"+item.customerId+"</td>";
				html += "<td>"+item.firstName+"</td>";
				html += "<td>"+item.lastName+"</td>";
				html += "<td>"+item.email+"</td>";
				html += "/<tr>";
				$("#list").append(html);
			});
		}
	});
	
	
	$.ajax({
		url : "/sakila/customer/selectCountryListAll",
		method : "post",
		success : function(json) {
			// console.log(json);
			$("#countryList").empty();
			$(json).each(function(index, item){ 
				temp = "<option value = '";
				temp += item.countryId;
				temp += "'>";
				temp += item.country;
				temp += "</option>";
				$("#countryList").append(temp);
			});
		}
	});
	
	$("#cityList").change(function() {
		$("#cityId").val($("#cityList").val());
	});
	
	// country를 선택하고 city선택..
	$("#countryList").change(function() {
		$.ajax({
			url : "/sakila/customer/selectCityListByCountry",
			method : "post",
			data : {"countryId" : $("#countryList").val()},
			success : function(json) {
				// console.log(json);
				console.log("success country choice!");
				$("#cityList").empty();
				$(json).each(function(index, item){
					temp = "<option value = '";
					temp += item.cityId;
					temp += "'>";
					temp += item.city;
					temp += "</option>";
					$("#cityList").append(temp);
				});
			}
		});
	});
	
	// addAddress 클릭시
	$("#addCustomer").click( function() {
		if($("#cityId").val() === "" || $("#address").val() === "" || $("#address2").val() === "" || $("#district").val() === "" || $("#postalCode").val() === "" || $("#phone").val() === ""){
			alert("다 입력 후 눌러주세용~");
		} else {
			$.ajax({
				url : "/sakila/customer/insertCustomer",
				method : "post",
				data : {"cityId" : $("#cityId").val(), "address" : $("#address").val(), "address2" : $("#address2").val(), "district" : $("#district").val(), "postalCode" : $("#postalCode").val(), "phone" : $("#phone").val(), "storeId" : $("#storeId").val(), "firstName" : $("#firstName").val(), "lastName" : $("#lastName").val(), "email" : $("#email").val()},
				success : function(json) {
					console.log("success!");
					console.log( $("#cityId").val() );
					console.log( $("#address").val() );
					console.log( $("#address2").val() );
					console.log( $("#district").val() );
					console.log( $("#postalCode").val() );
					console.log( $("#phone").val() );
					console.log( $("#storeId").val() );
					console.log( $("#firstName").val() );
					console.log( $("#lastName").val()  );
					console.log( $("#email").val() );
					
					//$("#list").empty();
					
				}
			});
		}
	});
	</script>
</body>
</html>






